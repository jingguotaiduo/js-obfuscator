var a1238_0x340564=a1238_0x255f;(function(_0x2cd5ce,_0x66bc32){var _0x15a1c9=a1238_0x255f,_0x3df3d5=_0x2cd5ce();while(!![]){try{var _0x3f9e0f=parseInt(_0x15a1c9(0xaf))/0x1*(-parseInt(_0x15a1c9(0xa9))/0x2)+parseInt(_0x15a1c9(0xbd))/0x3+-parseInt(_0x15a1c9(0x92))/0x4*(parseInt(_0x15a1c9(0xc6))/0x5)+parseInt(_0x15a1c9(0x7a))/0x6+-parseInt(_0x15a1c9(0xa4))/0x7+parseInt(_0x15a1c9(0xcc))/0x8*(parseInt(_0x15a1c9(0xc2))/0x9)+-parseInt(_0x15a1c9(0x7d))/0xa*(-parseInt(_0x15a1c9(0x88))/0xb);if(_0x3f9e0f===_0x66bc32)break;else _0x3df3d5['push'](_0x3df3d5['shift']());}catch(_0xf0f030){_0x3df3d5['push'](_0x3df3d5['shift']());}}}(a1238_0x2dc6,0x38fb9));import a1238_0x41cab3 from'../Core/defined.js';import a1238_0x5d300c from'../Core/Check.js';import a1238_0x59eb2e from'../Core/PixelFormat.js';import a1238_0x47b415 from'../Core/RuntimeError.js';import a1238_0x57d932 from'../Core//VulkanConstants.js';import a1238_0x1ac4d6 from'../Renderer/PixelDatatype.js';function a1238_0x2dc6(){var _0x5ea1eb=['FLOAT','2124346OfSVsS','cTFBC3_RGBA','positiveZ','cTFETC2_RGBA','RGB_PVRTC_4BPPV1','422pIUkNY','then','RGB','RGBA_PVRTC_4BPPV1','etc1','getHeight','2029owQpfh','RGB8_ETC2','Invalid\x20KTX2\x20file.','RGBA_BC7','s3tc','positiveX','dataFormatDescriptor','sizeInBytes','pvrtc','startTranscoding()\x20failed','No\x20transcoding\x20format\x20target\x20available\x20for\x20UASTC\x20compressed\x20ktx2.','layerCount','etc','RGBA_ASTC','671406JyyEPm','RGBA_DXT5','buffer','startTranscoding','VK_FORMAT_R32G32B32A32_SFLOAT','9SmkCFW','onmessage','astc','transcoderModule','5QEwKXr','length','VK_FORMAT_R8G8B8A8_UNORM','cTFPVRTC1_4_RGB','data','transcoder_texture_format','2670800HOaXUP','negativeY','negativeX','typeSize','KTX2\x203D\x20textures\x20are\x20unsupported.','bc7','delete','levelCount','2211264FWFtXk','getLevels','supportedTargetFormats','108820hgUTUI','pixelHeight','close','HALF_FLOAT','value','push','cTFBC7_RGBA','negativeZ','cTFASTC_4x4_RGBA','vkFormat','positiveY','352wnRQKk','RGB_ETC1','cTFETC1_RGB','RGB_DXT1','pixelWidth','colorModel','cTFBC1_RGB','levels','transcodeImage()\x20failed.','pixelDepth','1237688IJsCgc','getHasAlpha','VK_FORMAT_R8G8B8_SRGB','getImageTranscodedSizeInBytes','MSC_TRANSCODER','cTFPVRTC1_4_RGBA','transcodeImage','RGBA','webAssemblyConfig','KTX2File','typeOf','UNSIGNED_BYTE','byteOffset','VK_FORMAT_R16G16B16A16_SFLOAT','faceCount','RGBA8_ETC2_EAC','wasmBinaryFile'];a1238_0x2dc6=function(){return _0x5ea1eb;};return a1238_0x2dc6();}import a1238_0x22494b from'./createTaskProcessorWorker.js';function a1238_0x255f(_0x3c7a43,_0x42a5d8){var _0x2dc699=a1238_0x2dc6();return a1238_0x255f=function(_0x255f80,_0x5531fd){_0x255f80=_0x255f80-0x73;var _0x4457b0=_0x2dc699[_0x255f80];return _0x4457b0;},a1238_0x255f(_0x3c7a43,_0x42a5d8);}import a1238_0x296f14 from'../ThirdParty/ktx-parse.js';var faceOrder=[a1238_0x340564(0xb4),a1238_0x340564(0x74),a1238_0x340564(0x87),a1238_0x340564(0x73),a1238_0x340564(0xa6),a1238_0x340564(0x84)],colorModelETC1S=0xa3,colorModelUASTC=0xa6,transcoderModule;function transcode(_0x4976e4,_0x56d016){var _0x452294=a1238_0x340564;a1238_0x5d300c[_0x452294(0x9c)]['object'](_0x452294(0xc5),transcoderModule);var _0x2d1cc3=_0x4976e4['ktx2Buffer'],_0x4d1e55=_0x4976e4[_0x452294(0x7c)],_0xd1381b;try{_0xd1381b=a1238_0x296f14(_0x2d1cc3);}catch(_0x3e970c){throw new a1238_0x47b415(_0x452294(0xb1));}if(_0xd1381b[_0x452294(0xba)]!==0x0)throw new a1238_0x47b415('KTX2\x20texture\x20arrays\x20are\x20not\x20supported.');if(_0xd1381b[_0x452294(0x91)]!==0x0)throw new a1238_0x47b415(_0x452294(0x76));var _0x5b07d1=_0xd1381b[_0x452294(0xb5)][0x0],_0x13ad4e=new Array(_0xd1381b[_0x452294(0x79)]);return _0xd1381b[_0x452294(0x86)]===0x0&&(_0x5b07d1[_0x452294(0x8d)]===colorModelETC1S||_0x5b07d1[_0x452294(0x8d)]===colorModelUASTC)?transcodeCompressed(_0x2d1cc3,_0xd1381b,_0x4d1e55,transcoderModule,_0x56d016,_0x13ad4e):(_0x56d016[_0x452294(0x82)](_0x2d1cc3[_0x452294(0xbf)]),parseUncompressed(_0xd1381b,_0x13ad4e)),_0x13ad4e;}function parseUncompressed(_0x16965c,_0x581b27){var _0x15c17=a1238_0x340564,_0x184f36=_0x16965c[_0x15c17(0x86)]===a1238_0x57d932[_0x15c17(0x94)]?a1238_0x59eb2e[_0x15c17(0xab)]:a1238_0x59eb2e[_0x15c17(0x99)],_0x589e86;if(_0x16965c[_0x15c17(0x86)]===a1238_0x57d932[_0x15c17(0xc8)])_0x589e86=a1238_0x1ac4d6[_0x15c17(0x9d)];else{if(_0x16965c[_0x15c17(0x86)]===a1238_0x57d932[_0x15c17(0x9f)])_0x589e86=a1238_0x1ac4d6[_0x15c17(0x80)];else _0x16965c[_0x15c17(0x86)]===a1238_0x57d932[_0x15c17(0xc1)]&&(_0x589e86=a1238_0x1ac4d6[_0x15c17(0xa3)]);}for(var _0x24dedd=0x0;_0x24dedd<_0x16965c[_0x15c17(0x8f)][_0x15c17(0xc7)];++_0x24dedd){var _0x2f465c={};_0x581b27[_0x24dedd]=_0x2f465c;var _0x40bc5d=_0x16965c[_0x15c17(0x8f)][_0x24dedd]['levelData'],_0x1ae66d=_0x16965c[_0x15c17(0x8c)]>>_0x24dedd,_0x22a9a5=_0x16965c[_0x15c17(0x7e)]>>_0x24dedd,_0x44bf8d=_0x1ae66d*_0x22a9a5*a1238_0x59eb2e['componentsLength'](_0x184f36);for(var _0x5768de=0x0;_0x5768de<_0x16965c[_0x15c17(0xa0)];++_0x5768de){var _0x673807=_0x40bc5d[_0x15c17(0x9e)]+_0x44bf8d*_0x16965c[_0x15c17(0x75)]*_0x5768de,_0x43dcc3;if(!a1238_0x41cab3(_0x589e86)||a1238_0x1ac4d6[_0x15c17(0xb6)](_0x589e86)===0x1)_0x43dcc3=new Uint8Array(_0x40bc5d[_0x15c17(0xbf)],_0x673807,_0x44bf8d);else a1238_0x1ac4d6[_0x15c17(0xb6)](_0x589e86)===0x2?_0x43dcc3=new Uint16Array(_0x40bc5d[_0x15c17(0xbf)],_0x673807,_0x44bf8d):_0x43dcc3=new Float32Array(_0x40bc5d['buffer'],_0x673807,_0x44bf8d);_0x2f465c[faceOrder[_0x5768de]]={'internalFormat':_0x184f36,'datatype':_0x589e86,'width':_0x1ae66d,'height':_0x22a9a5,'levelBuffer':_0x43dcc3};}}}function transcodeCompressed(_0x5d9adb,_0x5afe,_0x428ff7,_0x81e7a8,_0x5c0f07,_0xb750cc){var _0x16ebe6=a1238_0x340564,_0x229e28=new _0x81e7a8[(_0x16ebe6(0x9b))](_0x5d9adb),_0x58c2bf=_0x229e28['getWidth'](),_0x5d4394=_0x229e28[_0x16ebe6(0xae)](),_0x5786bf=_0x229e28[_0x16ebe6(0x7b)](),_0x32b05c=_0x229e28[_0x16ebe6(0x93)]();if(!(_0x58c2bf>0x0)||!(_0x5d4394>0x0)||!(_0x5786bf>0x0)){_0x229e28[_0x16ebe6(0x7f)](),_0x229e28[_0x16ebe6(0x78)]();throw new a1238_0x47b415('Invalid\x20KTX2\x20file');}var _0x50433e,_0xedd8b3,_0x3957ea=_0x5afe[_0x16ebe6(0xb5)][0x0],_0x3398c4=_0x81e7a8[_0x16ebe6(0xcb)];if(_0x3957ea[_0x16ebe6(0x8d)]===colorModelETC1S){if(_0x428ff7[_0x16ebe6(0xbb)])_0x50433e=_0x32b05c?a1238_0x59eb2e[_0x16ebe6(0xa1)]:a1238_0x59eb2e[_0x16ebe6(0xb0)],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0xa7)]:_0x3398c4['cTFETC1_RGB'];else{if(_0x428ff7[_0x16ebe6(0xad)]&&!_0x32b05c)_0x50433e=a1238_0x59eb2e[_0x16ebe6(0x89)],_0xedd8b3=_0x3398c4[_0x16ebe6(0x8a)];else{if(_0x428ff7[_0x16ebe6(0xb3)])_0x50433e=_0x32b05c?a1238_0x59eb2e[_0x16ebe6(0xbe)]:a1238_0x59eb2e['RGB_DXT1'],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0xa5)]:_0x3398c4[_0x16ebe6(0x8e)];else{if(_0x428ff7['pvrtc'])_0x50433e=_0x32b05c?a1238_0x59eb2e['RGBA_PVRTC_4BPPV1']:a1238_0x59eb2e[_0x16ebe6(0xa8)],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0x97)]:_0x3398c4[_0x16ebe6(0xc9)];else{if(_0x428ff7[_0x16ebe6(0xc4)])_0x50433e=a1238_0x59eb2e['RGBA_ASTC'],_0xedd8b3=_0x3398c4[_0x16ebe6(0x85)];else{if(_0x428ff7['bc7'])_0x50433e=a1238_0x59eb2e[_0x16ebe6(0xb2)],_0xedd8b3=_0x3398c4[_0x16ebe6(0x83)];else throw new a1238_0x47b415('No\x20transcoding\x20format\x20target\x20available\x20for\x20ETC1S\x20compressed\x20ktx2.');}}}}}}else{if(_0x3957ea[_0x16ebe6(0x8d)]===colorModelUASTC){if(_0x428ff7['astc'])_0x50433e=a1238_0x59eb2e[_0x16ebe6(0xbc)],_0xedd8b3=_0x3398c4[_0x16ebe6(0x85)];else{if(_0x428ff7[_0x16ebe6(0x77)])_0x50433e=a1238_0x59eb2e[_0x16ebe6(0xb2)],_0xedd8b3=_0x3398c4[_0x16ebe6(0x83)];else{if(_0x428ff7['s3tc'])_0x50433e=_0x32b05c?a1238_0x59eb2e[_0x16ebe6(0xbe)]:a1238_0x59eb2e[_0x16ebe6(0x8b)],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0xa5)]:_0x3398c4[_0x16ebe6(0x8e)];else{if(_0x428ff7[_0x16ebe6(0xbb)])_0x50433e=_0x32b05c?a1238_0x59eb2e[_0x16ebe6(0xa1)]:a1238_0x59eb2e[_0x16ebe6(0xb0)],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0xa7)]:_0x3398c4[_0x16ebe6(0x8a)];else{if(_0x428ff7[_0x16ebe6(0xad)]&&!_0x32b05c)_0x50433e=a1238_0x59eb2e[_0x16ebe6(0x89)],_0xedd8b3=_0x3398c4['cTFETC1_RGB'];else{if(_0x428ff7[_0x16ebe6(0xb7)])_0x50433e=_0x32b05c?a1238_0x59eb2e[_0x16ebe6(0xac)]:a1238_0x59eb2e[_0x16ebe6(0xa8)],_0xedd8b3=_0x32b05c?_0x3398c4[_0x16ebe6(0x97)]:_0x3398c4['cTFPVRTC1_4_RGB'];else throw new a1238_0x47b415(_0x16ebe6(0xb9));}}}}}}}if(!_0x229e28[_0x16ebe6(0xc0)]()){_0x229e28[_0x16ebe6(0x7f)](),_0x229e28[_0x16ebe6(0x78)]();throw new a1238_0x47b415(_0x16ebe6(0xb8));}for(var _0xb0f598=0x0;_0xb0f598<_0x5afe[_0x16ebe6(0x8f)]['length'];++_0xb0f598){var _0x37e532={};_0xb750cc[_0xb0f598]=_0x37e532,_0x58c2bf=_0x5afe[_0x16ebe6(0x8c)]>>_0xb0f598,_0x5d4394=_0x5afe[_0x16ebe6(0x7e)]>>_0xb0f598;var _0x50441b=_0x229e28[_0x16ebe6(0x95)](_0xb0f598,0x0,0x0,_0xedd8b3['value']),_0x5eb262=new Uint8Array(_0x50441b),_0x1feed2=_0x229e28[_0x16ebe6(0x98)](_0x5eb262,_0xb0f598,0x0,0x0,_0xedd8b3[_0x16ebe6(0x81)],0x0,-0x1,-0x1);if(!a1238_0x41cab3(_0x1feed2))throw new a1238_0x47b415(_0x16ebe6(0x90));_0x5c0f07[_0x16ebe6(0x82)](_0x5eb262[_0x16ebe6(0xbf)]),_0x37e532[faceOrder[0x0]]={'internalFormat':_0x50433e,'width':_0x58c2bf,'height':_0x5d4394,'levelBuffer':_0x5eb262};}return _0x229e28[_0x16ebe6(0x7f)](),_0x229e28['delete'](),_0xb750cc;}function initWorker(_0x4e5479){var _0x5f48ed=a1238_0x340564;transcoderModule=_0x4e5479,transcoderModule['initializeBasis'](),self[_0x5f48ed(0xc3)]=a1238_0x22494b(transcode),self['postMessage'](!![]);}function transcodeKTX2(_0x10663a){var _0x395c08=a1238_0x340564,_0x10a6d0=_0x10663a[_0x395c08(0xca)],_0x92d510=_0x10a6d0[_0x395c08(0x9a)];if(a1238_0x41cab3(_0x92d510))return require([_0x92d510['modulePath']],function(_0x1516d3){var _0x43a2d5=_0x395c08;if(a1238_0x41cab3(_0x92d510[_0x43a2d5(0xa2)]))!a1238_0x41cab3(_0x1516d3)&&(_0x1516d3=self[_0x43a2d5(0x96)]),_0x1516d3(_0x92d510)['then'](function(_0x17eae3){initWorker(_0x17eae3);});else return _0x1516d3()[_0x43a2d5(0xaa)](function(_0x562377){initWorker(_0x562377);});});}export default transcodeKTX2;