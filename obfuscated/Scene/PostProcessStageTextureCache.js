var a695_0x4f85af=a695_0x5a26;function a695_0x17da(){var _0x2f6f02=['equals','_isSupported','enabled','1490440Hlntto','bloom','2098BcGFIa','get','_stageNameToFramebuffer','getStageByName','push','destroy','length','9144tTWMrT','min','prototype','execute','913444dgdlns','_textureScale','getFramebuffer','280WJmSVw','forcePowerOfTwo','6558192rgwKzo','_forcePowerOfTwo','_clearColor','_height','stages','inputPreviousStageTexture','string','clearColor','91ebcJIB','_collection','update','pixelDatatype','isPowerOfTwo','_framebuffers','1082253uwxggw','_updateDependencies','getOwnPropertyNames','clear','_pixelDatatype','isDestroyed','nextPowerOfTwo','getOutputTexture','ambientOcclusion','uniforms','fxaa','pixelFormat','_width','buffer','drawingBufferHeight','updateDependencies','drawingBufferWidth','3366306hEfoeQ','_tonemapping','textureScale'];a695_0x17da=function(){return _0x2f6f02;};return a695_0x17da();}(function(_0x471f72,_0xf3a2e3){var _0x44f7d2=a695_0x5a26,_0x26157c=_0x471f72();while(!![]){try{var _0x1b29f9=-parseInt(_0x44f7d2(0x79))/0x1*(parseInt(_0x44f7d2(0xa2))/0x2)+parseInt(_0x44f7d2(0x89))/0x3+-parseInt(_0x44f7d2(0x76))/0x4+parseInt(_0x44f7d2(0xa0))/0x5+-parseInt(_0x44f7d2(0x9a))/0x6+-parseInt(_0x44f7d2(0x83))/0x7*(-parseInt(_0x44f7d2(0xa9))/0x8)+parseInt(_0x44f7d2(0x7b))/0x9;if(_0x1b29f9===_0xf3a2e3)break;else _0x26157c['push'](_0x26157c['shift']());}catch(_0x3bcc6d){_0x26157c['push'](_0x26157c['shift']());}}}(a695_0x17da,0x4df16));import a695_0x3aedb5 from'../Core/Color.js';import a695_0xd927ad from'../Core/defined.js';import a695_0x18365e from'../Core/destroyObject.js';import a695_0x5349c1 from'../Core/Math.js';import a695_0x109fdf from'../Renderer/ClearCommand.js';import a695_0x1d9155 from'../Renderer/Framebuffer.js';import a695_0x3352a7 from'../Renderer/Texture.js';function PostProcessStageTextureCache(_0x4a8882){var _0x6ad1c9=a695_0x5a26;this[_0x6ad1c9(0x84)]=_0x4a8882,this[_0x6ad1c9(0x88)]=[],this[_0x6ad1c9(0xa4)]={},this[_0x6ad1c9(0x95)]=undefined,this['_height']=undefined,this['_updateDependencies']=![];}function getLastStageName(_0x48c8a7){var _0xa63fbd=a695_0x5a26;while(a695_0xd927ad(_0x48c8a7['length'])){_0x48c8a7=_0x48c8a7[_0xa63fbd(0xa3)](_0x48c8a7[_0xa63fbd(0xa8)]-0x1);}return _0x48c8a7['name'];}function getStageDependencies(_0x277927,_0x2caf64,_0x70d814,_0x42b1e9,_0x196e31){var _0x42120b=a695_0x5a26;if(!_0x42b1e9[_0x42120b(0x9f)]||!_0x42b1e9[_0x42120b(0x9e)](_0x2caf64))return _0x196e31;var _0x52d119=_0x70d814[_0x42b1e9['name']]={};if(a695_0xd927ad(_0x196e31)){var _0x5f474c=_0x277927['getStageByName'](_0x196e31);_0x52d119[getLastStageName(_0x5f474c)]=!![];}var _0xd13f33=_0x42b1e9[_0x42120b(0x92)];if(a695_0xd927ad(_0xd13f33)){var _0x3e70f9=Object[_0x42120b(0x8b)](_0xd13f33),_0x5f0a42=_0x3e70f9[_0x42120b(0xa8)];for(var _0x37d46a=0x0;_0x37d46a<_0x5f0a42;++_0x37d46a){var _0x25b70c=_0xd13f33[_0x3e70f9[_0x37d46a]];if(typeof _0x25b70c===_0x42120b(0x81)){var _0x4d75d5=_0x277927['getStageByName'](_0x25b70c);a695_0xd927ad(_0x4d75d5)&&(_0x52d119[getLastStageName(_0x4d75d5)]=!![]);}}}return _0x42b1e9['name'];}function getCompositeDependencies(_0x4077e2,_0x20d983,_0x8e6540,_0x41d3ee,_0x473cc7){var _0x571d51=a695_0x5a26;if(a695_0xd927ad(_0x41d3ee['enabled'])&&!_0x41d3ee['enabled']||a695_0xd927ad(_0x41d3ee['_isSupported'])&&!_0x41d3ee['_isSupported'](_0x20d983))return _0x473cc7;var _0x2831b9=_0x473cc7,_0xf5ce7d=!a695_0xd927ad(_0x41d3ee[_0x571d51(0x80)])||_0x41d3ee['inputPreviousStageTexture'],_0x416ea4=_0x473cc7,_0xc899e3=_0x41d3ee['length'];for(var _0x3dc778=0x0;_0x3dc778<_0xc899e3;++_0x3dc778){var _0xcfe49c=_0x41d3ee['get'](_0x3dc778);a695_0xd927ad(_0xcfe49c[_0x571d51(0xa8)])?_0x416ea4=getCompositeDependencies(_0x4077e2,_0x20d983,_0x8e6540,_0xcfe49c,_0x473cc7):_0x416ea4=getStageDependencies(_0x4077e2,_0x20d983,_0x8e6540,_0xcfe49c,_0x473cc7),_0xf5ce7d&&(_0x473cc7=_0x416ea4);}var _0x1da3d4,_0x19d2fc;if(!_0xf5ce7d)for(_0x1da3d4=0x1;_0x1da3d4<_0xc899e3;++_0x1da3d4){_0x19d2fc=getLastStageName(_0x41d3ee[_0x571d51(0xa3)](_0x1da3d4));var _0x474293=_0x8e6540[_0x19d2fc];for(var _0x360811=0x0;_0x360811<_0x1da3d4;++_0x360811){_0x474293[getLastStageName(_0x41d3ee['get'](_0x360811))]=!![];}}else for(_0x1da3d4=0x1;_0x1da3d4<_0xc899e3;++_0x1da3d4){_0x19d2fc=getLastStageName(_0x41d3ee[_0x571d51(0xa3)](_0x1da3d4)),!a695_0xd927ad(_0x8e6540[_0x19d2fc])&&(_0x8e6540[_0x19d2fc]={}),_0x8e6540[_0x19d2fc][_0x2831b9]=!![];}return _0x416ea4;}function getDependencies(_0x58a52f,_0x3c1707){var _0x2d7a99=a695_0x5a26,_0x24377b={};if(a695_0xd927ad(_0x58a52f[_0x2d7a99(0x91)])){var _0x2e862e=_0x58a52f[_0x2d7a99(0x91)],_0x1b6076=_0x58a52f[_0x2d7a99(0xa1)],_0x4407b1=_0x58a52f['_tonemapping'],_0x1a52c7=_0x58a52f[_0x2d7a99(0x93)],_0x4a4d14=getCompositeDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x2e862e,undefined);_0x4a4d14=getCompositeDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x1b6076,_0x4a4d14),_0x4a4d14=getStageDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x4407b1,_0x4a4d14),_0x4a4d14=getCompositeDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x58a52f,_0x4a4d14),getStageDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x1a52c7,_0x4a4d14);}else getCompositeDependencies(_0x58a52f,_0x3c1707,_0x24377b,_0x58a52f,undefined);return _0x24377b;}function getFramebuffer(_0xab1dbf,_0x7772d2,_0x58778d){var _0x355a72=a695_0x5a26,_0x1a3146=_0xab1dbf['_collection'],_0x44b2fb=_0x1a3146[_0x355a72(0xa5)](_0x7772d2),_0x55b5e8=_0x44b2fb[_0x355a72(0x77)],_0xa28f56=_0x44b2fb[_0x355a72(0x7c)],_0x88edd3=_0x44b2fb['_pixelFormat'],_0x30cc2a=_0x44b2fb[_0x355a72(0x8d)],_0x5ec547=_0x44b2fb[_0x355a72(0x7d)],_0x2aec07,_0x2633e9,_0xc3710d=_0xab1dbf[_0x355a72(0x88)],_0x17f75e=_0xc3710d[_0x355a72(0xa8)];for(_0x2aec07=0x0;_0x2aec07<_0x17f75e;++_0x2aec07){_0x2633e9=_0xc3710d[_0x2aec07];if(_0x55b5e8!==_0x2633e9[_0x355a72(0x9c)]||_0xa28f56!==_0x2633e9[_0x355a72(0x7a)]||_0x88edd3!==_0x2633e9[_0x355a72(0x94)]||_0x30cc2a!==_0x2633e9[_0x355a72(0x86)]||!a695_0x3aedb5[_0x355a72(0x9d)](_0x5ec547,_0x2633e9[_0x355a72(0x82)]))continue;var _0x487f73=_0x2633e9[_0x355a72(0x7f)],_0xbeae1=_0x487f73[_0x355a72(0xa8)],_0x3240aa=![];for(var _0x279200=0x0;_0x279200<_0xbeae1;++_0x279200){if(_0x58778d[_0x487f73[_0x279200]]){_0x3240aa=!![];break;}}if(!_0x3240aa)break;}if(a695_0xd927ad(_0x2633e9)&&_0x2aec07<_0x17f75e)return _0x2633e9['stages'][_0x355a72(0xa6)](_0x7772d2),_0x2633e9;return _0x2633e9={'textureScale':_0x55b5e8,'forcePowerOfTwo':_0xa28f56,'pixelFormat':_0x88edd3,'pixelDatatype':_0x30cc2a,'clearColor':_0x5ec547,'stages':[_0x7772d2],'buffer':undefined,'clear':undefined},_0xc3710d[_0x355a72(0xa6)](_0x2633e9),_0x2633e9;}function createFramebuffers(_0xe4dec6,_0x9b6922){var _0x31849f=a695_0x5a26,_0xeb17f8=getDependencies(_0xe4dec6[_0x31849f(0x84)],_0x9b6922);for(var _0x24ba3c in _0xeb17f8){_0xeb17f8['hasOwnProperty'](_0x24ba3c)&&(_0xe4dec6[_0x31849f(0xa4)][_0x24ba3c]=getFramebuffer(_0xe4dec6,_0x24ba3c,_0xeb17f8[_0x24ba3c]));}}function releaseResources(_0x44a4cf){var _0x1d9b10=a695_0x5a26,_0x350708=_0x44a4cf[_0x1d9b10(0x88)],_0x1bf239=_0x350708[_0x1d9b10(0xa8)];for(var _0x1d3599=0x0;_0x1d3599<_0x1bf239;++_0x1d3599){var _0x310389=_0x350708[_0x1d3599];_0x310389[_0x1d9b10(0x96)]=_0x310389['buffer']&&_0x310389[_0x1d9b10(0x96)]['destroy'](),_0x310389[_0x1d9b10(0x96)]=undefined;}}function updateFramebuffers(_0x5a964d,_0x5294ce){var _0x5bc566=a695_0x5a26,_0x1e86c0=_0x5a964d[_0x5bc566(0x95)],_0x38f675=_0x5a964d[_0x5bc566(0x7e)],_0x4e2ba1=_0x5a964d[_0x5bc566(0x88)],_0x225d87=_0x4e2ba1[_0x5bc566(0xa8)];for(var _0x50f2ad=0x0;_0x50f2ad<_0x225d87;++_0x50f2ad){var _0x563e1e=_0x4e2ba1[_0x50f2ad],_0xcf12=_0x563e1e['textureScale'],_0x2f1105=Math['ceil'](_0x1e86c0*_0xcf12),_0x1e8385=Math['ceil'](_0x38f675*_0xcf12),_0x86d951=Math[_0x5bc566(0xaa)](_0x2f1105,_0x1e8385);_0x563e1e[_0x5bc566(0x7a)]&&(!a695_0x5349c1[_0x5bc566(0x87)](_0x86d951)&&(_0x86d951=a695_0x5349c1[_0x5bc566(0x8f)](_0x86d951)),_0x2f1105=_0x86d951,_0x1e8385=_0x86d951),_0x563e1e[_0x5bc566(0x96)]=new a695_0x1d9155({'context':_0x5294ce,'colorTextures':[new a695_0x3352a7({'context':_0x5294ce,'width':_0x2f1105,'height':_0x1e8385,'pixelFormat':_0x563e1e['pixelFormat'],'pixelDatatype':_0x563e1e['pixelDatatype']})]}),_0x563e1e['clear']=new a695_0x109fdf({'color':_0x563e1e[_0x5bc566(0x82)],'framebuffer':_0x563e1e[_0x5bc566(0x96)]});}}PostProcessStageTextureCache[a695_0x4f85af(0xab)][a695_0x4f85af(0x98)]=function(){var _0x64d355=a695_0x4f85af;this[_0x64d355(0x8a)]=!![];},PostProcessStageTextureCache[a695_0x4f85af(0xab)][a695_0x4f85af(0x85)]=function(_0x50b488){var _0x464d14=a695_0x4f85af,_0x437204=this['_collection'],_0x215191=this[_0x464d14(0x8a)],_0x37e896=a695_0xd927ad(_0x437204[_0x464d14(0x91)])&&_0x437204['ambientOcclusion']['enabled']&&_0x437204['ambientOcclusion'][_0x464d14(0x9e)](_0x50b488),_0x2c079c=a695_0xd927ad(_0x437204[_0x464d14(0xa1)])&&_0x437204[_0x464d14(0xa1)]['enabled']&&_0x437204[_0x464d14(0xa1)][_0x464d14(0x9e)](_0x50b488),_0x34ce45=a695_0xd927ad(_0x437204[_0x464d14(0x9b)])&&_0x437204[_0x464d14(0x9b)][_0x464d14(0x9f)]&&_0x437204['_tonemapping'][_0x464d14(0x9e)](_0x50b488),_0x5be75a=a695_0xd927ad(_0x437204[_0x464d14(0x93)])&&_0x437204[_0x464d14(0x93)][_0x464d14(0x9f)]&&_0x437204[_0x464d14(0x93)]['_isSupported'](_0x50b488),_0x269d1d=!a695_0xd927ad(_0x437204['_activeStages'])||_0x437204['_activeStages']['length']>0x0||_0x37e896||_0x2c079c||_0x34ce45||_0x5be75a;(_0x215191||!_0x269d1d&&this['_framebuffers'][_0x464d14(0xa8)]>0x0)&&(releaseResources(this),this[_0x464d14(0x88)][_0x464d14(0xa8)]=0x0,this['_stageNameToFramebuffer']={},this['_width']=undefined,this['_height']=undefined);if(!_0x215191&&!_0x269d1d)return;this[_0x464d14(0x88)][_0x464d14(0xa8)]===0x0&&createFramebuffers(this,_0x50b488);var _0x3d1d31=_0x50b488[_0x464d14(0x99)],_0x310109=_0x50b488[_0x464d14(0x97)],_0x16c5cb=this['_width']!==_0x3d1d31||this[_0x464d14(0x7e)]!==_0x310109;if(!_0x215191&&!_0x16c5cb)return;this[_0x464d14(0x95)]=_0x3d1d31,this[_0x464d14(0x7e)]=_0x310109,this[_0x464d14(0x8a)]=![],releaseResources(this),updateFramebuffers(this,_0x50b488);},PostProcessStageTextureCache[a695_0x4f85af(0xab)]['clear']=function(_0x251871){var _0xe9861e=a695_0x4f85af,_0x186752=this[_0xe9861e(0x88)];for(var _0x2b1a8d=0x0;_0x2b1a8d<_0x186752[_0xe9861e(0xa8)];++_0x2b1a8d){_0x186752[_0x2b1a8d][_0xe9861e(0x8c)][_0xe9861e(0x75)](_0x251871);}},PostProcessStageTextureCache['prototype'][a695_0x4f85af(0xa5)]=function(_0x4a6fcf){var _0x5ac104=a695_0x4f85af;return this[_0x5ac104(0x84)][_0x5ac104(0xa5)](_0x4a6fcf);},PostProcessStageTextureCache[a695_0x4f85af(0xab)][a695_0x4f85af(0x90)]=function(_0x1d00f9){var _0xf6f35c=a695_0x4f85af;return this[_0xf6f35c(0x84)]['getOutputTexture'](_0x1d00f9);},PostProcessStageTextureCache[a695_0x4f85af(0xab)][a695_0x4f85af(0x78)]=function(_0x1d7fae){var _0x30b3db=a695_0x4f85af,_0x4be964=this[_0x30b3db(0xa4)][_0x1d7fae];if(!a695_0xd927ad(_0x4be964))return undefined;return _0x4be964['buffer'];},PostProcessStageTextureCache['prototype'][a695_0x4f85af(0x8e)]=function(){return![];},PostProcessStageTextureCache[a695_0x4f85af(0xab)][a695_0x4f85af(0xa7)]=function(){return releaseResources(this),a695_0x18365e(this);};function a695_0x5a26(_0x258129,_0x3cb7de){var _0x17da92=a695_0x17da();return a695_0x5a26=function(_0x5a2656,_0x4996dd){_0x5a2656=_0x5a2656-0x75;var _0x4b1391=_0x17da92[_0x5a2656];return _0x4b1391;},a695_0x5a26(_0x258129,_0x3cb7de);}export default PostProcessStageTextureCache;