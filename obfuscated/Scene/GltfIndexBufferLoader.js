var a528_0x1afafa=a528_0x447a;(function(_0x2733f2,_0x58002b){var _0x4be6a0=a528_0x447a,_0x4d36be=_0x2733f2();while(!![]){try{var _0x5d2cd5=parseInt(_0x4be6a0(0xce))/0x1+parseInt(_0x4be6a0(0xc4))/0x2*(-parseInt(_0x4be6a0(0xd5))/0x3)+-parseInt(_0x4be6a0(0xed))/0x4+-parseInt(_0x4be6a0(0xeb))/0x5*(parseInt(_0x4be6a0(0xb7))/0x6)+parseInt(_0x4be6a0(0xaf))/0x7*(parseInt(_0x4be6a0(0xb1))/0x8)+parseInt(_0x4be6a0(0xcb))/0x9*(parseInt(_0x4be6a0(0xdb))/0xa)+parseInt(_0x4be6a0(0xf2))/0xb;if(_0x5d2cd5===_0x58002b)break;else _0x4d36be['push'](_0x4d36be['shift']());}catch(_0x425c3d){_0x4d36be['push'](_0x4d36be['shift']());}}}(a528_0x5025,0xbf429));import a528_0x3e0fc8 from'../Core/Check.js';import a528_0x2282d4 from'../Core/ComponentDatatype.js';import a528_0x1131cd from'../Core/defaultValue.js';import a528_0x401e99 from'../Core/defined.js';import a528_0x2d5f8b from'../Core/IndexDatatype.js';import a528_0x11908c from'../Renderer/Buffer.js';import a528_0x303f15 from'../Renderer/BufferUsage.js';import a528_0x3a3834 from'../ThirdParty/when.js';import a528_0x447b65 from'./JobType.js';import a528_0x5b5170 from'./ResourceLoader.js';import a528_0x120196 from'./ResourceLoaderState.js';export default function GltfIndexBufferLoader(_0x1c8e66){var _0x4773ca=a528_0x447a;_0x1c8e66=a528_0x1131cd(_0x1c8e66,a528_0x1131cd[_0x4773ca(0xd6)]);var _0x52e117=_0x1c8e66['resourceCache'],_0x363a8f=_0x1c8e66[_0x4773ca(0xba)],_0x558c28=_0x1c8e66[_0x4773ca(0xe1)],_0x5a27c2=_0x1c8e66[_0x4773ca(0xc5)],_0x42526a=_0x1c8e66[_0x4773ca(0xe5)],_0x3fcbd4=_0x1c8e66[_0x4773ca(0xf0)],_0x4abb4b=_0x1c8e66[_0x4773ca(0xc0)],_0x3c3eb1=a528_0x1131cd(_0x1c8e66[_0x4773ca(0xee)],!![]),_0x2bec94=a528_0x1131cd(_0x1c8e66['loadAsTypedArray'],![]);a528_0x3e0fc8[_0x4773ca(0xb9)][_0x4773ca(0xe6)](_0x4773ca(0xec),_0x52e117),a528_0x3e0fc8[_0x4773ca(0xb9)][_0x4773ca(0xdd)]('options.gltf',_0x363a8f),a528_0x3e0fc8[_0x4773ca(0xb9)]['number']('options.accessorId',_0x558c28),a528_0x3e0fc8[_0x4773ca(0xb9)][_0x4773ca(0xdd)]('options.gltfResource',_0x5a27c2),a528_0x3e0fc8[_0x4773ca(0xb9)][_0x4773ca(0xdd)]('options.baseResource',_0x42526a);var _0x4a7ffa=_0x363a8f[_0x4773ca(0xe9)][_0x558c28]['componentType'];this[_0x4773ca(0xbe)]=_0x52e117,this[_0x4773ca(0xca)]=_0x5a27c2,this['_baseResource']=_0x42526a,this[_0x4773ca(0xc2)]=_0x363a8f,this[_0x4773ca(0xab)]=_0x558c28,this[_0x4773ca(0xe7)]=_0x4a7ffa,this['_draco']=_0x3fcbd4,this[_0x4773ca(0xd0)]=_0x4abb4b,this[_0x4773ca(0xaa)]=_0x3c3eb1,this['_loadAsTypedArray']=_0x2bec94,this[_0x4773ca(0xf5)]=undefined,this[_0x4773ca(0xb4)]=undefined,this[_0x4773ca(0xc7)]=undefined,this[_0x4773ca(0xbb)]=undefined,this[_0x4773ca(0xcd)]=a528_0x120196['UNLOADED'],this['_promise']=a528_0x3a3834[_0x4773ca(0xf3)]();}function a528_0x5025(){var _0x198c0a=['30EqlPyf','promise','object','_baseResource','STATIC_DRAW','loadDraco','accessorId','fromTypedArray','_loadAsTypedArray','vertexArrayDestroyable','baseResource','func','_indexDatatype','decodedData','accessors','bufferView','4385sOchCW','options.resourceCache','1221532OsBrIU','asynchronous','FAILED','draco','execute','9287465IDMpBc','defer','constructor','_bufferViewLoader','BUFFER','createIndexBuffer','context','_asynchronous','_accessorId','count','set','otherwise','48657huShjG','LOADING','488pnOAou','buffer','unload','_dracoLoader','UNSIGNED_INT','defineProperties','7584XYicyr','getError','typeOf','gltf','_buffer','componentType','_draco','_resourceCache','READY','cacheKey','_promise','_gltf','then','2LrWzwk','gltfResource','loadBufferView','_typedArray','destroy','resolve','_gltfResource','4332357UTIvWk','indexDatatype','_state','1021364zibAwO','create','_cacheKey','jobScheduler','typedArray','prototype','byteOffset','4609491HYtmNq','EMPTY_OBJECT','UNSIGNED_SHORT','process','PROCESSING','isDestroyed'];a528_0x5025=function(){return _0x198c0a;};return a528_0x5025();}a528_0x401e99(Object[a528_0x1afafa(0xcf)])&&(GltfIndexBufferLoader[a528_0x1afafa(0xd3)]=Object[a528_0x1afafa(0xcf)](a528_0x5b5170[a528_0x1afafa(0xd3)]),GltfIndexBufferLoader[a528_0x1afafa(0xd3)][a528_0x1afafa(0xf4)]=GltfIndexBufferLoader);Object[a528_0x1afafa(0xb6)](GltfIndexBufferLoader['prototype'],{'promise':{'get':function(){var _0x265b4b=a528_0x1afafa;return this['_promise'][_0x265b4b(0xdc)];}},'cacheKey':{'get':function(){var _0x2732d0=a528_0x1afafa;return this[_0x2732d0(0xd0)];}},'buffer':{'get':function(){var _0x3fddbf=a528_0x1afafa;return this[_0x3fddbf(0xbb)];}},'typedArray':{'get':function(){var _0x440ce8=a528_0x1afafa;return this[_0x440ce8(0xc7)];}},'indexDatatype':{'get':function(){var _0x4ec17e=a528_0x1afafa;return this[_0x4ec17e(0xe7)];}}}),GltfIndexBufferLoader[a528_0x1afafa(0xd3)]['load']=function(){var _0x5dc430=a528_0x1afafa;a528_0x401e99(this[_0x5dc430(0xbd)])?loadFromDraco(this):loadFromBufferView(this);};function loadFromDraco(_0x421fec){var _0x57bd27=a528_0x1afafa,_0x5174a4=_0x421fec[_0x57bd27(0xbe)],_0x17ad2d=_0x5174a4[_0x57bd27(0xe0)]({'gltf':_0x421fec[_0x57bd27(0xc2)],'draco':_0x421fec[_0x57bd27(0xbd)],'gltfResource':_0x421fec[_0x57bd27(0xca)],'baseResource':_0x421fec[_0x57bd27(0xde)]});_0x421fec['_dracoLoader']=_0x17ad2d,_0x421fec[_0x57bd27(0xcd)]=a528_0x120196[_0x57bd27(0xb0)],_0x17ad2d['promise'][_0x57bd27(0xc3)](function(){var _0x530864=_0x57bd27;if(_0x421fec['isDestroyed']())return;var _0x128e98=_0x17ad2d[_0x530864(0xe8)]['indices'][_0x530864(0xd2)];_0x421fec[_0x530864(0xc7)]=_0x128e98,_0x421fec[_0x530864(0xe7)]=a528_0x2282d4[_0x530864(0xe2)](_0x128e98),_0x421fec[_0x530864(0xcd)]=a528_0x120196[_0x530864(0xd9)];})[_0x57bd27(0xae)](function(_0x12aa62){var _0xfad888=_0x57bd27;if(_0x421fec[_0xfad888(0xda)]())return;handleError(_0x421fec,_0x12aa62);});}function loadFromBufferView(_0x5d7426){var _0x5eb9dc=a528_0x1afafa,_0x4a2d31=_0x5d7426['_gltf'],_0x1c91e4=_0x5d7426['_accessorId'],_0x267c1c=_0x4a2d31[_0x5eb9dc(0xe9)][_0x1c91e4],_0x15ed98=_0x267c1c[_0x5eb9dc(0xea)],_0x225ad9=_0x5d7426[_0x5eb9dc(0xbe)],_0x8426f4=_0x225ad9[_0x5eb9dc(0xc6)]({'gltf':_0x4a2d31,'bufferViewId':_0x15ed98,'gltfResource':_0x5d7426[_0x5eb9dc(0xca)],'baseResource':_0x5d7426[_0x5eb9dc(0xde)]});_0x5d7426['_state']=a528_0x120196[_0x5eb9dc(0xb0)],_0x5d7426['_bufferViewLoader']=_0x8426f4,_0x8426f4[_0x5eb9dc(0xdc)]['then'](function(){var _0x47f25b=_0x5eb9dc;if(_0x5d7426['isDestroyed']())return;var _0xaf46f3=_0x8426f4['typedArray'];_0x5d7426[_0x47f25b(0xc7)]=createIndicesTypedArray(_0x5d7426,_0xaf46f3),_0x5d7426[_0x47f25b(0xcd)]=a528_0x120196[_0x47f25b(0xd9)];})[_0x5eb9dc(0xae)](function(_0x409baa){var _0x3ffd4e=_0x5eb9dc;if(_0x5d7426[_0x3ffd4e(0xda)]())return;handleError(_0x5d7426,_0x409baa);});}function createIndicesTypedArray(_0x3941d2,_0x170320){var _0x23016d=a528_0x1afafa,_0x5292a1=_0x3941d2[_0x23016d(0xc2)],_0x1ee473=_0x3941d2['_accessorId'],_0x3fd437=_0x5292a1[_0x23016d(0xe9)][_0x1ee473],_0x1dba34=_0x3fd437[_0x23016d(0xac)],_0x366c85=_0x3fd437[_0x23016d(0xbc)],_0x26f95e=_0x170320[_0x23016d(0xb2)],_0x26203c=_0x170320[_0x23016d(0xd4)]+_0x3fd437['byteOffset'],_0xa07509;if(_0x366c85===a528_0x2d5f8b['UNSIGNED_BYTE'])_0xa07509=new Uint8Array(_0x26f95e,_0x26203c,_0x1dba34);else{if(_0x366c85===a528_0x2d5f8b[_0x23016d(0xd7)])_0xa07509=new Uint16Array(_0x26f95e,_0x26203c,_0x1dba34);else _0x366c85===a528_0x2d5f8b[_0x23016d(0xb5)]&&(_0xa07509=new Uint32Array(_0x26f95e,_0x26203c,_0x1dba34));}return _0xa07509;}function handleError(_0x28ceb3,_0x10233a){var _0x37504a=a528_0x1afafa;_0x28ceb3[_0x37504a(0xb3)](),_0x28ceb3[_0x37504a(0xcd)]=a528_0x120196[_0x37504a(0xef)];var _0x4fdd83='Failed\x20to\x20load\x20index\x20buffer';_0x10233a=_0x28ceb3[_0x37504a(0xb8)](_0x4fdd83,_0x10233a),_0x28ceb3[_0x37504a(0xc1)]['reject'](_0x10233a);}function CreateIndexBufferJob(){var _0x1484c2=a528_0x1afafa;this[_0x1484c2(0xd2)]=undefined,this[_0x1484c2(0xcc)]=undefined,this[_0x1484c2(0xa9)]=undefined,this[_0x1484c2(0xb2)]=undefined;}CreateIndexBufferJob['prototype']['set']=function(_0x1a7303,_0xada99f,_0x37ca76){var _0x1804df=a528_0x1afafa;this[_0x1804df(0xd2)]=_0x1a7303,this['indexDatatype']=_0xada99f,this[_0x1804df(0xa9)]=_0x37ca76;},CreateIndexBufferJob[a528_0x1afafa(0xd3)][a528_0x1afafa(0xf1)]=function(){var _0x38b91c=a528_0x1afafa;this['buffer']=createIndexBuffer(this[_0x38b91c(0xd2)],this[_0x38b91c(0xcc)],this[_0x38b91c(0xa9)]);};function createIndexBuffer(_0xf2224,_0x4b67c0,_0x57557b){var _0x3cd2c5=a528_0x1afafa,_0x26d348=a528_0x11908c[_0x3cd2c5(0xf7)]({'typedArray':_0xf2224,'context':_0x57557b,'usage':a528_0x303f15[_0x3cd2c5(0xdf)],'indexDatatype':_0x4b67c0});return _0x26d348[_0x3cd2c5(0xe4)]=![],_0x26d348;}function a528_0x447a(_0xe8b16c,_0x58ce25){var _0x50252f=a528_0x5025();return a528_0x447a=function(_0x447a18,_0x10eaf9){_0x447a18=_0x447a18-0xa9;var _0x357274=_0x50252f[_0x447a18];return _0x357274;},a528_0x447a(_0xe8b16c,_0x58ce25);}var scratchIndexBufferJob=new CreateIndexBufferJob();GltfIndexBufferLoader['prototype'][a528_0x1afafa(0xd8)]=function(_0x95b7af){var _0x56fd80=a528_0x1afafa;a528_0x3e0fc8[_0x56fd80(0xb9)]['object']('frameState',_0x95b7af);if(this[_0x56fd80(0xcd)]===a528_0x120196[_0x56fd80(0xbf)])return;var _0x18954b=this[_0x56fd80(0xc7)],_0x44e58a=this['_indexDatatype'];a528_0x401e99(this[_0x56fd80(0xb4)])&&this[_0x56fd80(0xb4)][_0x56fd80(0xd8)](_0x95b7af);a528_0x401e99(this[_0x56fd80(0xf5)])&&this[_0x56fd80(0xf5)][_0x56fd80(0xd8)](_0x95b7af);if(!a528_0x401e99(_0x18954b))return;if(this[_0x56fd80(0xe3)]){this['unload'](),this[_0x56fd80(0xc7)]=_0x18954b,this['_state']=a528_0x120196[_0x56fd80(0xbf)],this['_promise'][_0x56fd80(0xc9)](this);return;}var _0x5827b1;if(this[_0x56fd80(0xaa)]){var _0xf2eaa0=scratchIndexBufferJob;_0xf2eaa0[_0x56fd80(0xad)](_0x18954b,_0x44e58a,_0x95b7af['context']);var _0x2ee2ee=_0x95b7af[_0x56fd80(0xd1)];if(!_0x2ee2ee[_0x56fd80(0xf1)](_0xf2eaa0,a528_0x447b65[_0x56fd80(0xf6)]))return;_0x5827b1=_0xf2eaa0[_0x56fd80(0xb2)];}else _0x5827b1=createIndexBuffer(_0x18954b,_0x44e58a,_0x95b7af['context']);this[_0x56fd80(0xb3)](),this['_buffer']=_0x5827b1,this[_0x56fd80(0xcd)]=a528_0x120196[_0x56fd80(0xbf)],this[_0x56fd80(0xc1)][_0x56fd80(0xc9)](this);},GltfIndexBufferLoader[a528_0x1afafa(0xd3)]['unload']=function(){var _0x5f0019=a528_0x1afafa;a528_0x401e99(this[_0x5f0019(0xbb)])&&this['_buffer'][_0x5f0019(0xc8)]();var _0x2df88a=this[_0x5f0019(0xbe)];a528_0x401e99(this[_0x5f0019(0xf5)])&&_0x2df88a[_0x5f0019(0xb3)](this[_0x5f0019(0xf5)]),a528_0x401e99(this[_0x5f0019(0xb4)])&&_0x2df88a[_0x5f0019(0xb3)](this[_0x5f0019(0xb4)]),this['_bufferViewLoader']=undefined,this[_0x5f0019(0xb4)]=undefined,this[_0x5f0019(0xc7)]=undefined,this[_0x5f0019(0xbb)]=undefined,this[_0x5f0019(0xc2)]=undefined;};