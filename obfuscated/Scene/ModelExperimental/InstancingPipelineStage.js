var a627_0x31fb02=a627_0x4248;(function(_0x1b1c58,_0x395f2f){var _0x4f4c62=a627_0x4248,_0x701753=_0x1b1c58();while(!![]){try{var _0x51a576=parseInt(_0x4f4c62(0x1b3))/0x1*(-parseInt(_0x4f4c62(0x1b2))/0x2)+parseInt(_0x4f4c62(0x1a7))/0x3*(-parseInt(_0x4f4c62(0x1b5))/0x4)+parseInt(_0x4f4c62(0x1d4))/0x5*(parseInt(_0x4f4c62(0x1bd))/0x6)+-parseInt(_0x4f4c62(0x1b0))/0x7*(-parseInt(_0x4f4c62(0x19e))/0x8)+parseInt(_0x4f4c62(0x1c1))/0x9*(parseInt(_0x4f4c62(0x1c5))/0xa)+parseInt(_0x4f4c62(0x1aa))/0xb+-parseInt(_0x4f4c62(0x1c4))/0xc*(-parseInt(_0x4f4c62(0x1a8))/0xd);if(_0x51a576===_0x395f2f)break;else _0x701753['push'](_0x701753['shift']());}catch(_0x560562){_0x701753['push'](_0x701753['shift']());}}}(a627_0x3f27,0xaa013));import a627_0x51a922 from'../../Core/Cartesian3.js';import a627_0x27abef from'../../Core/ComponentDatatype.js';import a627_0x5f0b2c from'../../Core/defined.js';import a627_0x423d14 from'../../Core/Matrix4.js';import a627_0x4943d8 from'../AttributeType.js';function a627_0x3f27(){var _0xab3007=['instanceCount','shaderBuilder','a_instancingTransformRow1','365VcNAzs','_getInstanceTransformsTypedArray','TRANSLATION','getNumberOfComponents','push','maximumByComponent','getAttributeBySemantic','length','buffer','attributes','createVertexBuffer','featureIdVertexAttributeSetIndex','HAS_INSTANCE_MATRICES','8Bpnyws','a_instancingTransformRow0','packedTypedArray','instancingTranslationMin','FEATURE_ID','a_instanceTranslation','addAttribute','vec3','componentDatatype','3nTIRQd','13TEaTSX','addDefine','7150286tfnyTO','model','a_instancingTransformRow2','a_instanceFeatureId_','SCALE','ROTATION','6507928WcobCb','vertexArrayDestroyable','1123114xNHlMa','1JaYnrj','FLOAT','5294924vwWjaR','instancingTranslationMax','HAS_INSTANCE_TRANSLATION','semantic','vec4','getSizeInBytes','HAS_INSTANCE_SCALE','fill','13482JtUkIl','name','MAX_VALUE','apply','45ghQXuf','type','byteOffset','1645092lPrbbj','1401550YqrmdG','minimumByComponent','HAS_INSTANCING','float','attributeIndex','context','STATIC_DRAW','byteStride','fromTranslationQuaternionRotationScale','setIndex','process','_resources'];a627_0x3f27=function(){return _0xab3007;};return a627_0x3f27();}import a627_0x3150fa from'../../Core/Quaternion.js';import a627_0x1a981f from'../../Renderer/Buffer.js';function a627_0x4248(_0x1cacc3,_0x1578ef){var _0x3f27cd=a627_0x3f27();return a627_0x4248=function(_0x424895,_0x26846f){_0x424895=_0x424895-0x198;var _0x2a6e71=_0x3f27cd[_0x424895];return _0x2a6e71;},a627_0x4248(_0x1cacc3,_0x1578ef);}import a627_0x552896 from'../../Renderer/BufferUsage.js';import a627_0x35d1b3 from'../InstanceAttributeSemantic.js';import a627_0x3a28d8 from'./ModelExperimentalUtility.js';import a627_0x15dee9 from'../../Shaders/ModelExperimental/InstancingStageVS.js';var InstancingPipelineStage={};InstancingPipelineStage[a627_0x31fb02(0x1be)]='InstancingPipelineStage',InstancingPipelineStage[a627_0x31fb02(0x1cf)]=function(_0x226f1d,_0x3253cb,_0x36553b){var _0x3db73e=a627_0x31fb02,_0x23e4d7=_0x3253cb['instances'],_0x321089=_0x23e4d7[_0x3db73e(0x19a)][0x0]['count'],_0x11eaac=[],_0x1a2ac4=_0x226f1d['shaderBuilder'];_0x1a2ac4[_0x3db73e(0x1a9)](_0x3db73e(0x1c7)),_0x1a2ac4['addVertexLines']([a627_0x15dee9]);var _0x5839eb=a627_0x3a28d8['getAttributeBySemantic'](_0x23e4d7,a627_0x35d1b3[_0x3db73e(0x1d6)]),_0x11d479,_0x5ca123;a627_0x5f0b2c(_0x5839eb)&&(_0x11d479=_0x5839eb['max'],_0x5ca123=_0x5839eb['min']);var _0x11bbf8=a627_0x3a28d8[_0x3db73e(0x1da)](_0x23e4d7,a627_0x35d1b3[_0x3db73e(0x1af)]);if(a627_0x5f0b2c(_0x11bbf8)||!a627_0x5f0b2c(_0x11d479)||!a627_0x5f0b2c(_0x5ca123))_0x11eaac=processMatrixAttributes(_0x3253cb,_0x321089,_0x226f1d,_0x36553b);else{a627_0x5f0b2c(_0x5839eb)&&(_0x11eaac['push']({'index':_0x226f1d[_0x3db73e(0x1c9)]++,'vertexBuffer':_0x5839eb[_0x3db73e(0x199)],'componentsPerAttribute':a627_0x4943d8[_0x3db73e(0x1d7)](_0x5839eb[_0x3db73e(0x1c2)]),'componentDatatype':_0x5839eb[_0x3db73e(0x1a6)],'normalize':![],'offsetInBytes':_0x5839eb['byteOffset'],'strideInBytes':_0x5839eb[_0x3db73e(0x1cc)],'instanceDivisor':0x1}),_0x226f1d[_0x3db73e(0x1b6)]=_0x11d479,_0x226f1d[_0x3db73e(0x1a1)]=_0x5ca123,_0x1a2ac4[_0x3db73e(0x1a9)](_0x3db73e(0x1b7)),_0x1a2ac4[_0x3db73e(0x1a4)](_0x3db73e(0x1a5),_0x3db73e(0x1a3)));var _0xafec8b=a627_0x3a28d8[_0x3db73e(0x1da)](_0x23e4d7,a627_0x35d1b3[_0x3db73e(0x1ae)]);a627_0x5f0b2c(_0xafec8b)&&(_0x11eaac[_0x3db73e(0x1d8)]({'index':_0x226f1d[_0x3db73e(0x1c9)]++,'vertexBuffer':_0xafec8b['buffer'],'componentsPerAttribute':a627_0x4943d8['getNumberOfComponents'](_0xafec8b[_0x3db73e(0x1c2)]),'componentDatatype':_0xafec8b[_0x3db73e(0x1a6)],'normalize':![],'offsetInBytes':_0xafec8b[_0x3db73e(0x1c3)],'strideInBytes':_0xafec8b[_0x3db73e(0x1cc)],'instanceDivisor':0x1}),_0x1a2ac4[_0x3db73e(0x1a9)](_0x3db73e(0x1bb)),_0x1a2ac4['addAttribute']('vec3','a_instanceScale'));}processFeatureIdAttributes(_0x226f1d,_0x36553b,_0x23e4d7,_0x11eaac),_0x226f1d[_0x3db73e(0x1d1)]=_0x321089,_0x226f1d[_0x3db73e(0x19a)][_0x3db73e(0x1d8)][_0x3db73e(0x1c0)](_0x226f1d[_0x3db73e(0x19a)],_0x11eaac);};var translationScratch=new a627_0x51a922(),rotationScratch=new a627_0x3150fa(),scaleScratch=new a627_0x51a922(),transformScratch=new a627_0x423d14();function getInstanceTransformsTypedArray(_0x205a05,_0x21f362,_0x5b57b7){var _0x2e3bed=a627_0x31fb02,_0x5b1124=0xc,_0x4302d8=new Float32Array(_0x21f362*_0x5b1124),_0x27e7f6=a627_0x3a28d8['getAttributeBySemantic'](_0x205a05,a627_0x35d1b3[_0x2e3bed(0x1d6)]),_0x39784b=a627_0x3a28d8[_0x2e3bed(0x1da)](_0x205a05,a627_0x35d1b3[_0x2e3bed(0x1af)]),_0x3ef2ca=a627_0x3a28d8[_0x2e3bed(0x1da)](_0x205a05,a627_0x35d1b3[_0x2e3bed(0x1ae)]),_0x864fd7=new a627_0x51a922(-Number[_0x2e3bed(0x1bf)],-Number[_0x2e3bed(0x1bf)],-Number[_0x2e3bed(0x1bf)]),_0x157e26=new a627_0x51a922(Number[_0x2e3bed(0x1bf)],Number['MAX_VALUE'],Number['MAX_VALUE']),_0xa7d9af=a627_0x5f0b2c(_0x27e7f6),_0x213c92=a627_0x5f0b2c(_0x39784b),_0x198e61=a627_0x5f0b2c(_0x3ef2ca),_0xbddfea=_0xa7d9af?_0x27e7f6[_0x2e3bed(0x1a0)]:new Float32Array(_0x21f362*0x3),_0x5a1580=_0x213c92?_0x39784b[_0x2e3bed(0x1a0)]:new Float32Array(_0x21f362*0x4),_0x2a5602;_0x198e61?_0x2a5602=_0x3ef2ca[_0x2e3bed(0x1a0)]:(_0x2a5602=new Float32Array(_0x21f362*0x3),_0x2a5602[_0x2e3bed(0x1bc)](0x1));for(var _0x2d9f9e=0x0;_0x2d9f9e<_0x21f362;_0x2d9f9e++){var _0x654a0c=new a627_0x51a922(_0xbddfea[_0x2d9f9e*0x3],_0xbddfea[_0x2d9f9e*0x3+0x1],_0xbddfea[_0x2d9f9e*0x3+0x2],translationScratch);a627_0x51a922[_0x2e3bed(0x1d9)](_0x864fd7,_0x654a0c,_0x864fd7),a627_0x51a922[_0x2e3bed(0x1c6)](_0x157e26,_0x654a0c,_0x157e26);var _0x5965b9=new a627_0x3150fa(_0x5a1580[_0x2d9f9e*0x4],_0x5a1580[_0x2d9f9e*0x4+0x1],_0x5a1580[_0x2d9f9e*0x4+0x2],_0x213c92?_0x5a1580[_0x2d9f9e*0x4+0x3]:0x1,rotationScratch),_0x57ead9=new a627_0x51a922(_0x2a5602[_0x2d9f9e*0x3],_0x2a5602[_0x2d9f9e*0x3+0x1],_0x2a5602[_0x2d9f9e*0x3+0x2],scaleScratch),_0x136567=a627_0x423d14[_0x2e3bed(0x1cd)](_0x654a0c,_0x5965b9,_0x57ead9,transformScratch),_0x29edb1=_0x5b1124*_0x2d9f9e;_0x4302d8[_0x29edb1+0x0]=_0x136567[0x0],_0x4302d8[_0x29edb1+0x1]=_0x136567[0x4],_0x4302d8[_0x29edb1+0x2]=_0x136567[0x8],_0x4302d8[_0x29edb1+0x3]=_0x136567[0xc],_0x4302d8[_0x29edb1+0x4]=_0x136567[0x1],_0x4302d8[_0x29edb1+0x5]=_0x136567[0x5],_0x4302d8[_0x29edb1+0x6]=_0x136567[0x9],_0x4302d8[_0x29edb1+0x7]=_0x136567[0xd],_0x4302d8[_0x29edb1+0x8]=_0x136567[0x2],_0x4302d8[_0x29edb1+0x9]=_0x136567[0x6],_0x4302d8[_0x29edb1+0xa]=_0x136567[0xa],_0x4302d8[_0x29edb1+0xb]=_0x136567[0xe],_0x5b57b7[_0x2e3bed(0x1b6)]=_0x864fd7,_0x5b57b7[_0x2e3bed(0x1a1)]=_0x157e26;}return _0x4302d8;}function processFeatureIdAttributes(_0x171333,_0x3e59b9,_0x8902a1,_0x59fc50){var _0x260063=a627_0x31fb02,_0x5f16ba=_0x8902a1[_0x260063(0x19a)],_0x563ec9=_0x171333[_0x260063(0x1ab)],_0x3d2f49=_0x171333[_0x260063(0x1d2)];for(var _0x104612=0x0;_0x104612<_0x5f16ba[_0x260063(0x198)];_0x104612++){var _0x52b3ff=_0x5f16ba[_0x104612];if(_0x52b3ff[_0x260063(0x1b8)]!==a627_0x35d1b3[_0x260063(0x1a2)])continue;_0x52b3ff[_0x260063(0x1ce)]>=_0x171333[_0x260063(0x19c)]&&(_0x171333[_0x260063(0x19c)]=_0x52b3ff['setIndex']+0x1);var _0x1db2ad=a627_0x1a981f[_0x260063(0x19b)]({'context':_0x3e59b9[_0x260063(0x1ca)],'typedArray':_0x52b3ff['packedTypedArray'],'usage':a627_0x552896[_0x260063(0x1cb)]});_0x1db2ad[_0x260063(0x1b1)]=![],_0x563ec9[_0x260063(0x1d0)][_0x260063(0x1d8)](_0x1db2ad),_0x59fc50[_0x260063(0x1d8)]({'index':_0x171333['attributeIndex']++,'vertexBuffer':_0x1db2ad,'componentsPerAttribute':a627_0x4943d8[_0x260063(0x1d7)](_0x52b3ff[_0x260063(0x1c2)]),'componentDatatype':_0x52b3ff['componentDatatype'],'normalize':![],'offsetInBytes':_0x52b3ff[_0x260063(0x1c3)],'strideInBytes':_0x52b3ff[_0x260063(0x1cc)],'instanceDivisor':0x1}),_0x3d2f49['addAttribute'](_0x260063(0x1c8),_0x260063(0x1ad)+_0x52b3ff['setIndex']);}}function processMatrixAttributes(_0x597225,_0x3c0b7a,_0x3d0166,_0x348372){var _0x7d2784=a627_0x31fb02,_0x5cb164=getInstanceTransformsTypedArray(_0x597225['instances'],_0x3c0b7a,_0x3d0166),_0x2b0acd=a627_0x1a981f[_0x7d2784(0x19b)]({'context':_0x348372[_0x7d2784(0x1ca)],'typedArray':_0x5cb164,'usage':a627_0x552896[_0x7d2784(0x1cb)]});_0x2b0acd['vertexArrayDestroyable']=![],_0x3d0166[_0x7d2784(0x1ab)][_0x7d2784(0x1d0)][_0x7d2784(0x1d8)](_0x2b0acd);var _0x436d8f=0xc,_0x3f6f6b=a627_0x27abef[_0x7d2784(0x1ba)](a627_0x27abef[_0x7d2784(0x1b4)]),_0x47701a=[{'index':_0x3d0166[_0x7d2784(0x1c9)]++,'vertexBuffer':_0x2b0acd,'componentsPerAttribute':0x4,'componentDatatype':a627_0x27abef[_0x7d2784(0x1b4)],'normalize':![],'offsetInBytes':0x0,'strideInBytes':_0x3f6f6b*_0x436d8f,'instanceDivisor':0x1},{'index':_0x3d0166[_0x7d2784(0x1c9)]++,'vertexBuffer':_0x2b0acd,'componentsPerAttribute':0x4,'componentDatatype':a627_0x27abef[_0x7d2784(0x1b4)],'normalize':![],'offsetInBytes':_0x3f6f6b*0x4,'strideInBytes':_0x3f6f6b*_0x436d8f,'instanceDivisor':0x1},{'index':_0x3d0166[_0x7d2784(0x1c9)]++,'vertexBuffer':_0x2b0acd,'componentsPerAttribute':0x4,'componentDatatype':a627_0x27abef[_0x7d2784(0x1b4)],'normalize':![],'offsetInBytes':_0x3f6f6b*0x8,'strideInBytes':_0x3f6f6b*_0x436d8f,'instanceDivisor':0x1}],_0x2b5050=_0x3d0166[_0x7d2784(0x1d2)];return _0x2b5050[_0x7d2784(0x1a9)](_0x7d2784(0x19d)),_0x2b5050[_0x7d2784(0x1a4)](_0x7d2784(0x1b9),_0x7d2784(0x19f)),_0x2b5050[_0x7d2784(0x1a4)](_0x7d2784(0x1b9),_0x7d2784(0x1d3)),_0x2b5050['addAttribute'](_0x7d2784(0x1b9),_0x7d2784(0x1ac)),_0x47701a;}InstancingPipelineStage[a627_0x31fb02(0x1d5)]=getInstanceTransformsTypedArray;export default InstancingPipelineStage;