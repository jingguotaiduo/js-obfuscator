var a527_0x19482e=a527_0x3df3;(function(_0x4aca85,_0x455f42){var _0xe5a382=a527_0x3df3,_0x57b13b=_0x4aca85();while(!![]){try{var _0x5138a1=-parseInt(_0xe5a382(0x17a))/0x1+-parseInt(_0xe5a382(0x16e))/0x2*(-parseInt(_0xe5a382(0x15f))/0x3)+parseInt(_0xe5a382(0x170))/0x4+-parseInt(_0xe5a382(0x152))/0x5+parseInt(_0xe5a382(0x185))/0x6*(-parseInt(_0xe5a382(0x17c))/0x7)+-parseInt(_0xe5a382(0x171))/0x8*(-parseInt(_0xe5a382(0x164))/0x9)+-parseInt(_0xe5a382(0x189))/0xa;if(_0x5138a1===_0x455f42)break;else _0x57b13b['push'](_0x57b13b['shift']());}catch(_0x10a498){_0x57b13b['push'](_0x57b13b['shift']());}}}(a527_0x83cf,0x88142));import a527_0xac6c2e from'../Core/Check.js';import a527_0x296af6 from'../Core/defaultValue.js';import a527_0x6aef4b from'../Core/defined.js';import a527_0x33e98e from'../Core/loadImageFromTypedArray.js';import a527_0x2f86cf from'../Core/loadKTX2.js';import a527_0x1d78ce from'../Core/RuntimeError.js';import a527_0x166f67 from'../ThirdParty/when.js';import a527_0x1b4050 from'./ResourceLoader.js';import a527_0x548673 from'./ResourceLoaderState.js';export default function GltfImageLoader(_0xc1132c){var _0x7f5414=a527_0x3df3;_0xc1132c=a527_0x296af6(_0xc1132c,a527_0x296af6['EMPTY_OBJECT']);var _0x2224f0=_0xc1132c[_0x7f5414(0x188)],_0x1540ee=_0xc1132c[_0x7f5414(0x151)],_0x1d2778=_0xc1132c[_0x7f5414(0x15a)],_0x28c739=_0xc1132c[_0x7f5414(0x190)],_0x43b44a=_0xc1132c['baseResource'],_0x592f8e=_0xc1132c['cacheKey'];a527_0xac6c2e[_0x7f5414(0x181)][_0x7f5414(0x184)](_0x7f5414(0x158),_0x2224f0),a527_0xac6c2e[_0x7f5414(0x181)][_0x7f5414(0x18e)]('options.gltf',_0x1540ee),a527_0xac6c2e[_0x7f5414(0x181)][_0x7f5414(0x159)]('options.imageId',_0x1d2778),a527_0xac6c2e['typeOf'][_0x7f5414(0x18e)](_0x7f5414(0x194),_0x28c739),a527_0xac6c2e['typeOf']['object'](_0x7f5414(0x191),_0x43b44a);var _0x1a4055=_0x1540ee[_0x7f5414(0x180)][_0x1d2778],_0x538e72=_0x1a4055[_0x7f5414(0x17f)],_0x2edae5=_0x1a4055[_0x7f5414(0x15b)];this[_0x7f5414(0x150)]=_0x2224f0,this['_gltfResource']=_0x28c739,this[_0x7f5414(0x187)]=_0x43b44a,this[_0x7f5414(0x179)]=_0x1540ee,this[_0x7f5414(0x18d)]=_0x538e72,this[_0x7f5414(0x176)]=_0x2edae5,this[_0x7f5414(0x172)]=_0x592f8e,this[_0x7f5414(0x161)]=undefined,this[_0x7f5414(0x168)]=undefined,this[_0x7f5414(0x154)]=undefined,this['_state']=a527_0x548673[_0x7f5414(0x16d)],this[_0x7f5414(0x15e)]=a527_0x166f67[_0x7f5414(0x163)]();}a527_0x6aef4b(Object[a527_0x19482e(0x156)])&&(GltfImageLoader[a527_0x19482e(0x15c)]=Object[a527_0x19482e(0x156)](a527_0x1b4050['prototype']),GltfImageLoader[a527_0x19482e(0x15c)]['constructor']=GltfImageLoader);Object[a527_0x19482e(0x162)](GltfImageLoader[a527_0x19482e(0x15c)],{'promise':{'get':function(){var _0x25dcfa=a527_0x19482e;return this['_promise'][_0x25dcfa(0x17e)];}},'cacheKey':{'get':function(){var _0x2fa5b2=a527_0x19482e;return this[_0x2fa5b2(0x172)];}},'image':{'get':function(){var _0x528f6b=a527_0x19482e;return this[_0x528f6b(0x168)];}},'mipLevels':{'get':function(){return this['_mipLevels'];}}}),GltfImageLoader[a527_0x19482e(0x15c)][a527_0x19482e(0x155)]=function(){var _0x55b6cd=a527_0x19482e;a527_0x6aef4b(this[_0x55b6cd(0x18d)])?loadFromBufferView(this):loadFromUri(this);};function getImageAndMipLevels(_0x199a68){var _0xd6c25=a527_0x19482e,_0xbd0195;return Array['isArray'](_0x199a68)&&(_0xbd0195=_0x199a68[_0xd6c25(0x192)](0x1,_0x199a68[_0xd6c25(0x160)])[_0xd6c25(0x16c)](function(_0x332e2b){var _0x5d3346=_0xd6c25;return _0x332e2b[_0x5d3346(0x17f)];}),_0x199a68=_0x199a68[0x0]),{'image':_0x199a68,'mipLevels':_0xbd0195};}function loadFromBufferView(_0x5a50a0){var _0x4b632d=a527_0x19482e,_0x2cf4a7=_0x5a50a0[_0x4b632d(0x150)],_0x5718c0=_0x2cf4a7[_0x4b632d(0x174)]({'gltf':_0x5a50a0['_gltf'],'bufferViewId':_0x5a50a0[_0x4b632d(0x18d)],'gltfResource':_0x5a50a0[_0x4b632d(0x195)],'baseResource':_0x5a50a0['_baseResource']});_0x5a50a0[_0x4b632d(0x161)]=_0x5718c0,_0x5a50a0[_0x4b632d(0x183)]=a527_0x548673[_0x4b632d(0x165)],_0x5718c0[_0x4b632d(0x17e)][_0x4b632d(0x18c)](function(){var _0x2f3eb6=_0x4b632d;if(_0x5a50a0['isDestroyed']())return;var _0x52cebd=_0x5718c0[_0x2f3eb6(0x193)];return loadImageFromBufferTypedArray(_0x52cebd)[_0x2f3eb6(0x18c)](function(_0xa6b9d9){var _0x171e3d=_0x2f3eb6;if(_0x5a50a0[_0x171e3d(0x17b)]())return;var _0x622771=getImageAndMipLevels(_0xa6b9d9);_0x5a50a0[_0x171e3d(0x18a)](),_0x5a50a0['_image']=_0x622771[_0x171e3d(0x182)],_0x5a50a0['_mipLevels']=_0x622771[_0x171e3d(0x175)],_0x5a50a0[_0x171e3d(0x183)]=a527_0x548673[_0x171e3d(0x177)],_0x5a50a0[_0x171e3d(0x15e)][_0x171e3d(0x15d)](_0x5a50a0);});})['otherwise'](function(_0xf9fe4){var _0x49001d=_0x4b632d;if(_0x5a50a0[_0x49001d(0x17b)]())return;handleError(_0x5a50a0,_0xf9fe4,_0x49001d(0x18f));});}function loadFromUri(_0x2a37b6){var _0x2ff690=a527_0x19482e,_0x1af326=_0x2a37b6[_0x2ff690(0x187)],_0x51944f=_0x2a37b6[_0x2ff690(0x176)],_0x39a8e9=_0x1af326[_0x2ff690(0x169)]({'url':_0x51944f});_0x2a37b6[_0x2ff690(0x183)]=a527_0x548673[_0x2ff690(0x165)],loadImageFromUri(_0x39a8e9)[_0x2ff690(0x18c)](function(_0x599f33){var _0x5e0678=_0x2ff690;if(_0x2a37b6[_0x5e0678(0x17b)]())return;var _0x4c0e5b=getImageAndMipLevels(_0x599f33);_0x2a37b6[_0x5e0678(0x18a)](),_0x2a37b6['_image']=_0x4c0e5b[_0x5e0678(0x182)],_0x2a37b6[_0x5e0678(0x154)]=_0x4c0e5b['mipLevels'],_0x2a37b6[_0x5e0678(0x183)]=a527_0x548673[_0x5e0678(0x177)],_0x2a37b6['_promise'][_0x5e0678(0x15d)](_0x2a37b6);})[_0x2ff690(0x173)](function(_0x491248){var _0x111693=_0x2ff690;if(_0x2a37b6[_0x111693(0x17b)]())return;handleError(_0x2a37b6,_0x491248,'Failed\x20to\x20load\x20image:\x20'+_0x51944f);});}function a527_0x3df3(_0x4ef214,_0x360a17){var _0x83cf45=a527_0x83cf();return a527_0x3df3=function(_0x3df32c,_0x1b12eb){_0x3df32c=_0x3df32c-0x150;var _0x4cd8e3=_0x83cf45[_0x3df32c];return _0x4cd8e3;},a527_0x3df3(_0x4ef214,_0x360a17);}function handleError(_0x5b5fb3,_0x1b61d6,_0x2d715b){var _0x1844d8=a527_0x19482e;_0x5b5fb3[_0x1844d8(0x18a)](),_0x5b5fb3['_state']=a527_0x548673[_0x1844d8(0x17d)],_0x5b5fb3[_0x1844d8(0x15e)][_0x1844d8(0x166)](_0x5b5fb3[_0x1844d8(0x16a)](_0x2d715b,_0x1b61d6));}function a527_0x83cf(){var _0x552868=['defer','14292XDPzQl','LOADING','reject','_loadImageFromTypedArray','_image','getDerivedResource','getError','image/ktx2','map','UNLOADED','204rJYOPg','image/png','3122328UaMFUd','824uJmjrS','_cacheKey','otherwise','loadBufferView','mipLevels','_uri','READY','image/jpeg','_gltf','852923fCRCqj','isDestroyed','1218DAqNFS','FAILED','promise','bufferView','images','typeOf','image','_state','func','18FSIsvW','Image\x20format\x20is\x20not\x20recognized','_baseResource','resourceCache','1654610HgxHYk','unload','test','then','_bufferViewId','object','Failed\x20to\x20load\x20embedded\x20image','gltfResource','options.baseResource','slice','typedArray','options.gltfResource','_gltfResource','_resourceCache','gltf','972860cKAuGa','url','_mipLevels','load','create','subarray','options.resourceCache','number','imageId','uri','prototype','resolve','_promise','24315XKMpkr','length','_bufferViewLoader','defineProperties'];a527_0x83cf=function(){return _0x552868;};return a527_0x83cf();}function getMimeTypeFromTypedArray(_0x30971b){var _0x5227f3=a527_0x19482e,_0x323124=_0x30971b[_0x5227f3(0x157)](0x0,0x2),_0xe57494=_0x30971b['subarray'](0x0,0x4),_0x5e728b=_0x30971b[_0x5227f3(0x157)](0x8,0xc);if(_0x323124[0x0]===0xff&&_0x323124[0x1]===0xd8)return _0x5227f3(0x178);else{if(_0x323124[0x0]===0x89&&_0x323124[0x1]===0x50)return _0x5227f3(0x16f);else{if(_0x323124[0x0]===0xab&&_0x323124[0x1]===0x4b)return _0x5227f3(0x16b);else{if(_0xe57494[0x0]===0x52&&_0xe57494[0x1]===0x49&&_0xe57494[0x2]===0x46&&_0xe57494[0x3]===0x46&&_0x5e728b[0x0]===0x57&&_0x5e728b[0x1]===0x45&&_0x5e728b[0x2]===0x42&&_0x5e728b[0x3]===0x50)return'image/webp';}}}throw new a527_0x1d78ce(_0x5227f3(0x186));}function loadImageFromBufferTypedArray(_0x207dda){var _0x1a8427=a527_0x19482e,_0x18fb50=getMimeTypeFromTypedArray(_0x207dda);if(_0x18fb50===_0x1a8427(0x16b)){var _0x18bfdf=new Uint8Array(_0x207dda);return a527_0x2f86cf(_0x18bfdf);}return GltfImageLoader[_0x1a8427(0x167)]({'uint8Array':_0x207dda,'format':_0x18fb50,'flipY':![],'skipColorSpaceConversion':!![]});}var ktx2Regex=/(^data:image\/ktx2)|(\.ktx2$)/i;function loadImageFromUri(_0x38edaf){var _0x1a6660=a527_0x19482e,_0x2a72f9=_0x38edaf[_0x1a6660(0x153)];if(ktx2Regex[_0x1a6660(0x18b)](_0x2a72f9))return a527_0x2f86cf(_0x38edaf);return _0x38edaf['fetchImage']({'skipColorSpaceConversion':!![],'preferImageBitmap':!![]});}GltfImageLoader[a527_0x19482e(0x15c)][a527_0x19482e(0x18a)]=function(){var _0x3b7657=a527_0x19482e;a527_0x6aef4b(this[_0x3b7657(0x161)])&&this[_0x3b7657(0x150)][_0x3b7657(0x18a)](this['_bufferViewLoader']),this[_0x3b7657(0x161)]=undefined,this[_0x3b7657(0x176)]=undefined,this[_0x3b7657(0x168)]=undefined,this['_mipLevels']=undefined,this[_0x3b7657(0x179)]=undefined;},GltfImageLoader[a527_0x19482e(0x167)]=a527_0x33e98e;