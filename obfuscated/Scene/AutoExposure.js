var a420_0xb8cffb=a420_0x5e86;function a420_0x5d36(){var _0x1881c3=['139676vrviRb','\x20\x20\x20\x20\x20\x20\x20\x20for\x20(int\x20j\x20=\x200;\x20j\x20<\x203;\x20++j)\x20{\x20\x0a','_command','_width','previousLuminance','width','update','uniform\x20sampler2D\x20colorTexture;\x20\x0a','}\x0a\x0a','clear','minimumLuminance','framebuffer','720435SeTWbd','_minMaxLuminance','float\x20sampleTexture(vec2\x20offset)\x20{\x20\x0a','HALF_FLOAT','minMaxLuminance','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offset.x\x20=\x20-xStep\x20+\x20float(i)\x20*\x20xStep;\x20\x0a','124809gOarzT','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offset.y\x20=\x20-yStep\x20+\x20float(j)\x20*\x20yStep;\x20\x0a','\x20\x20\x20\x20float\x20previous\x20=\x20texture2D(previousLuminance,\x20vec2(0.5)).r;\x20\x0a','\x20\x20\x20\x20\x20\x20\x20\x20color\x20/=\x20float(count);\x20\x0a','_enabled','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color\x20+=\x20sampleTexture(offset);\x20\x0a','40ykSqEH','varying\x20vec2\x20v_textureCoordinates;\x20\x0a','225864TvHnGf','FLOAT','RGBA','NEAREST','6yJXeBD','136gyAfgx','_uniformMap','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20\x0a','uniform\x20sampler2D\x20previousLuminance;\x20\x0a','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec2\x20offset;\x20\x0a','\x20\x20\x20\x20\x20\x20\x20\x20}\x20\x0a','1358wqmtoY','execute','\x20\x20\x20\x20float\x20color\x20=\x200.0;\x20\x0a','shaderProgram','uniform\x20vec2\x20colorTextureDimensions;\x20\x0a','_depthTexture','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(offset.x\x20<\x200.0\x20||\x20offset.x\x20>\x201.0\x20||\x20offset.y\x20<\x200.0\x20||\x20offset.y\x20>\x201.0)\x20{\x20\x0a','maximumLuminance','\x20\x20\x20\x20return\x20czm_luminance(color.rgb);\x20\x0a','4076700KOJidp','createViewportQuadCommand','_colorTexture','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20++count;\x20\x0a','24nKLLQC','czm_autoexposure','uniform\x20vec2\x20minMaxLuminance;\x20\x0a','drawingBufferHeight','max','_useLogDepth','_ready','void\x20main()\x20{\x20\x0a','ceil','prototype','\x20\x20\x20\x20return\x20texture2D(colorTexture,\x20v_textureCoordinates\x20+\x20offset).r;\x20\x0a','\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(color);\x20\x0a','destroy','_commands','length','_previousLuminance','log','_clearCommand','getColorTexture','2958dCmQPt','dimensions','_framebuffers','1670999NzwTHP','_name','_height','}\x20\x0a','isDestroyed','drawingBufferWidth','\x20\x20\x20\x20color\x20=\x20clamp(color,\x20minMaxLuminance.x,\x20minMaxLuminance.y);\x20\x0a'];a420_0x5d36=function(){return _0x1881c3;};return a420_0x5d36();}(function(_0x45f582,_0x2099aa){var _0x47f255=a420_0x5e86,_0x3734ce=_0x45f582();while(!![]){try{var _0x5c16bb=parseInt(_0x47f255(0x166))/0x1*(parseInt(_0x47f255(0x184))/0x2)+-parseInt(_0x47f255(0x178))/0x3*(-parseInt(_0x47f255(0x17e))/0x4)+-parseInt(_0x47f255(0x172))/0x5+-parseInt(_0x47f255(0x1ab))/0x6*(-parseInt(_0x47f255(0x18b))/0x7)+-parseInt(_0x47f255(0x185))/0x8*(parseInt(_0x47f255(0x180))/0x9)+-parseInt(_0x47f255(0x194))/0xa+parseInt(_0x47f255(0x1ae))/0xb*(parseInt(_0x47f255(0x198))/0xc);if(_0x5c16bb===_0x2099aa)break;else _0x3734ce['push'](_0x3734ce['shift']());}catch(_0x3eb6f1){_0x3734ce['push'](_0x3734ce['shift']());}}}(a420_0x5d36,0x3e881));function a420_0x5e86(_0x4911a7,_0x2ede88){var _0x5d36d1=a420_0x5d36();return a420_0x5e86=function(_0x5e868d,_0x4516a9){_0x5e868d=_0x5e868d-0x160;var _0x520942=_0x5d36d1[_0x5e868d];return _0x520942;},a420_0x5e86(_0x4911a7,_0x2ede88);}import a420_0x30193b from'../Core/Cartesian2.js';import a420_0x14236b from'../Core/Color.js';import a420_0x26214f from'../Core/defined.js';import a420_0x4ded6f from'../Core/destroyObject.js';import a420_0x4e6f3b from'../Core/PixelFormat.js';import a420_0x3e65a4 from'../Renderer/ClearCommand.js';import a420_0x523a09 from'../Renderer/Framebuffer.js';import a420_0x34cb84 from'../Renderer/PixelDatatype.js';import a420_0x1c9a88 from'../Renderer/Sampler.js';import a420_0x1212ad from'../Renderer/Texture.js';function AutoExposure(){var _0x5c1f61=a420_0x5e86;this[_0x5c1f61(0x186)]=undefined,this[_0x5c1f61(0x168)]=undefined,this[_0x5c1f61(0x196)]=undefined,this[_0x5c1f61(0x190)]=undefined,this[_0x5c1f61(0x19e)]=![],this[_0x5c1f61(0x160)]=_0x5c1f61(0x199),this['_logDepthChanged']=undefined,this[_0x5c1f61(0x19d)]=undefined,this[_0x5c1f61(0x1ad)]=undefined,this[_0x5c1f61(0x1a7)]=undefined,this['_commands']=undefined,this['_clearCommand']=undefined,this[_0x5c1f61(0x173)]=new a420_0x30193b(),this['enabled']=!![],this[_0x5c1f61(0x17c)]=!![],this[_0x5c1f61(0x170)]=0.1,this[_0x5c1f61(0x192)]=0xa;}Object['defineProperties'](AutoExposure['prototype'],{'ready':{'get':function(){var _0x54846a=a420_0x5e86;return this[_0x54846a(0x19e)];}},'name':{'get':function(){var _0x5e30ad=a420_0x5e86;return this[_0x5e30ad(0x160)];}},'outputTexture':{'get':function(){var _0x33a3ec=a420_0x5e86,_0x28127c=this[_0x33a3ec(0x1ad)];if(!a420_0x26214f(_0x28127c))return undefined;return _0x28127c[_0x28127c[_0x33a3ec(0x1a6)]-0x1]['getColorTexture'](0x0);}}});function destroyFramebuffers(_0x5f552b){var _0x889f3c=a420_0x5e86,_0x337bf5=_0x5f552b[_0x889f3c(0x1ad)];if(!a420_0x26214f(_0x337bf5))return;var _0x1b6323=_0x337bf5[_0x889f3c(0x1a6)];for(var _0x1ec3d1=0x0;_0x1ec3d1<_0x1b6323;++_0x1ec3d1){_0x337bf5[_0x1ec3d1][_0x889f3c(0x1a4)]();}_0x5f552b[_0x889f3c(0x1ad)]=undefined,_0x5f552b[_0x889f3c(0x1a7)][_0x889f3c(0x1a4)](),_0x5f552b[_0x889f3c(0x1a7)]=undefined;}function createFramebuffers(_0x3d2973,_0x26ceef){var _0x38fdcf=a420_0x5e86;destroyFramebuffers(_0x3d2973);var _0x1f1681=_0x3d2973[_0x38fdcf(0x169)],_0x38a75e=_0x3d2973[_0x38fdcf(0x161)],_0x5f3f72=a420_0x4e6f3b[_0x38fdcf(0x182)],_0x4c393a=_0x26ceef['halfFloatingPointTexture']?a420_0x34cb84[_0x38fdcf(0x175)]:a420_0x34cb84[_0x38fdcf(0x181)],_0x6b331b=Math[_0x38fdcf(0x1a0)](Math[_0x38fdcf(0x1a8)](Math[_0x38fdcf(0x19c)](_0x1f1681,_0x38a75e))/Math[_0x38fdcf(0x1a8)](0x3)),_0x191230=new Array(_0x6b331b);for(var _0x4221b9=0x0;_0x4221b9<_0x6b331b;++_0x4221b9){_0x1f1681=Math['max'](Math[_0x38fdcf(0x1a0)](_0x1f1681/0x3),0x1),_0x38a75e=Math[_0x38fdcf(0x19c)](Math[_0x38fdcf(0x1a0)](_0x38a75e/0x3),0x1),_0x191230[_0x4221b9]=new a420_0x523a09({'context':_0x26ceef,'colorTextures':[new a420_0x1212ad({'context':_0x26ceef,'width':_0x1f1681,'height':_0x38a75e,'pixelFormat':_0x5f3f72,'pixelDatatype':_0x4c393a,'sampler':a420_0x1c9a88[_0x38fdcf(0x183)]})]});}var _0x2e7511=_0x191230[_0x6b331b-0x1][_0x38fdcf(0x1aa)](0x0);_0x3d2973[_0x38fdcf(0x1a7)]=new a420_0x523a09({'context':_0x26ceef,'colorTextures':[new a420_0x1212ad({'context':_0x26ceef,'width':_0x2e7511[_0x38fdcf(0x16b)],'height':_0x2e7511['height'],'pixelFormat':_0x5f3f72,'pixelDatatype':_0x4c393a,'sampler':a420_0x1c9a88[_0x38fdcf(0x183)]})]}),_0x3d2973[_0x38fdcf(0x1ad)]=_0x191230;}function destroyCommands(_0x40a0e6){var _0x378f4f=a420_0x5e86,_0x425ceb=_0x40a0e6['_commands'];if(!a420_0x26214f(_0x425ceb))return;var _0x3d9d8b=_0x425ceb[_0x378f4f(0x1a6)];for(var _0x3b930b=0x0;_0x3b930b<_0x3d9d8b;++_0x3b930b){_0x425ceb[_0x3b930b][_0x378f4f(0x18e)][_0x378f4f(0x1a4)]();}_0x40a0e6['_commands']=undefined;}function createUniformMap(_0x209a62,_0xc7c6c8){var _0x38d33b=a420_0x5e86,_0x59d525;if(_0xc7c6c8===0x0)_0x59d525={'colorTexture':function(){var _0x131ef6=a420_0x5e86;return _0x209a62[_0x131ef6(0x196)];},'colorTextureDimensions':function(){var _0x5992a2=a420_0x5e86;return _0x209a62['_colorTexture'][_0x5992a2(0x1ac)];}};else{var _0x42abe5=_0x209a62['_framebuffers'][_0xc7c6c8-0x1][_0x38d33b(0x1aa)](0x0);_0x59d525={'colorTexture':function(){return _0x42abe5;},'colorTextureDimensions':function(){var _0x507b48=_0x38d33b;return _0x42abe5[_0x507b48(0x1ac)];}};}return _0x59d525[_0x38d33b(0x176)]=function(){return _0x209a62['_minMaxLuminance'];},_0x59d525[_0x38d33b(0x16a)]=function(){var _0x1376d4=_0x38d33b;return _0x209a62[_0x1376d4(0x1a7)][_0x1376d4(0x1aa)](0x0);},_0x59d525;}function getShaderSource(_0xdc84e8,_0x15ab66){var _0x1992af=a420_0x5e86,_0x449759=_0x1992af(0x16d)+_0x1992af(0x17f)+_0x1992af(0x174);return _0xdc84e8===0x0?_0x449759+='\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(colorTexture,\x20v_textureCoordinates\x20+\x20offset);\x20\x0a'+_0x1992af(0x193):_0x449759+=_0x1992af(0x1a2),_0x449759+=_0x1992af(0x16e),_0x449759+=_0x1992af(0x18f)+_0x1992af(0x19a)+_0x1992af(0x188)+_0x1992af(0x19f)+_0x1992af(0x18d)+'\x20\x20\x20\x20float\x20xStep\x20=\x201.0\x20/\x20colorTextureDimensions.x;\x20\x0a'+'\x20\x20\x20\x20float\x20yStep\x20=\x201.0\x20/\x20colorTextureDimensions.y;\x20\x0a'+'\x20\x20\x20\x20int\x20count\x20=\x200;\x20\x0a'+'\x20\x20\x20\x20for\x20(int\x20i\x20=\x200;\x20i\x20<\x203;\x20++i)\x20{\x20\x0a'+_0x1992af(0x167)+_0x1992af(0x189)+_0x1992af(0x177)+_0x1992af(0x179)+_0x1992af(0x191)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20continue;\x20\x0a'+_0x1992af(0x187)+_0x1992af(0x17d)+_0x1992af(0x197)+_0x1992af(0x18a)+'\x20\x20\x20\x20}\x20\x0a'+'\x20\x20\x20\x20if\x20(count\x20>\x200)\x20{\x20\x0a'+_0x1992af(0x17b)+'\x20\x20\x20\x20}\x20\x0a',_0xdc84e8===_0x15ab66-0x1&&(_0x449759+=_0x1992af(0x17a)+'\x20\x20\x20\x20color\x20=\x20clamp(color,\x20minMaxLuminance.x,\x20minMaxLuminance.y);\x20\x0a'+'\x20\x20\x20\x20color\x20=\x20previous\x20+\x20(color\x20-\x20previous)\x20/\x20(60.0\x20*\x201.5);\x20\x0a'+_0x1992af(0x165)),_0x449759+=_0x1992af(0x1a3)+_0x1992af(0x162),_0x449759;}function createCommands(_0x2c7eef,_0x3b9968){var _0x17dbf7=a420_0x5e86;destroyCommands(_0x2c7eef);var _0x727ff3=_0x2c7eef[_0x17dbf7(0x1ad)],_0x5b4f1e=_0x727ff3[_0x17dbf7(0x1a6)],_0xf50ad2=new Array(_0x5b4f1e);for(var _0x387068=0x0;_0x387068<_0x5b4f1e;++_0x387068){_0xf50ad2[_0x387068]=_0x3b9968[_0x17dbf7(0x195)](getShaderSource(_0x387068,_0x5b4f1e),{'framebuffer':_0x727ff3[_0x387068],'uniformMap':createUniformMap(_0x2c7eef,_0x387068)});}_0x2c7eef['_commands']=_0xf50ad2;}AutoExposure[a420_0xb8cffb(0x1a1)][a420_0xb8cffb(0x16f)]=function(_0x53ddd6){var _0x3d3f77=a420_0xb8cffb,_0x1b2075=this[_0x3d3f77(0x1ad)];if(!a420_0x26214f(_0x1b2075))return;var _0x3d14ac=this['_clearCommand'];!a420_0x26214f(_0x3d14ac)&&(_0x3d14ac=this[_0x3d3f77(0x1a9)]=new a420_0x3e65a4({'color':new a420_0x14236b(0x0,0x0,0x0,0x0),'framebuffer':undefined}));var _0x2f9a60=_0x1b2075['length'];for(var _0x40ffd5=0x0;_0x40ffd5<_0x2f9a60;++_0x40ffd5){_0x3d14ac[_0x3d3f77(0x171)]=_0x1b2075[_0x40ffd5],_0x3d14ac[_0x3d3f77(0x18c)](_0x53ddd6);}},AutoExposure['prototype'][a420_0xb8cffb(0x16c)]=function(_0x324932){var _0x257048=a420_0xb8cffb,_0x53085b=_0x324932[_0x257048(0x164)],_0xb13c1c=_0x324932[_0x257048(0x19b)];(_0x53085b!==this[_0x257048(0x169)]||_0xb13c1c!==this[_0x257048(0x161)])&&(this[_0x257048(0x169)]=_0x53085b,this[_0x257048(0x161)]=_0xb13c1c,createFramebuffers(this,_0x324932),createCommands(this,_0x324932),!this[_0x257048(0x19e)]&&(this[_0x257048(0x19e)]=!![]));this['_minMaxLuminance']['x']=this[_0x257048(0x170)],this[_0x257048(0x173)]['y']=this[_0x257048(0x192)];var _0x388e24=this['_framebuffers'],_0x148859=_0x388e24[_0x388e24['length']-0x1];_0x388e24[_0x388e24[_0x257048(0x1a6)]-0x1]=this[_0x257048(0x1a7)],this[_0x257048(0x1a5)][this[_0x257048(0x1a5)]['length']-0x1][_0x257048(0x171)]=this[_0x257048(0x1a7)],this['_previousLuminance']=_0x148859;},AutoExposure['prototype']['execute']=function(_0x1051c9,_0x5aa9c2){var _0x5954cc=a420_0xb8cffb;this[_0x5954cc(0x196)]=_0x5aa9c2;var _0x23a897=this[_0x5954cc(0x1a5)];if(!a420_0x26214f(_0x23a897))return;var _0x1f4a7c=_0x23a897[_0x5954cc(0x1a6)];for(var _0x5767ac=0x0;_0x5767ac<_0x1f4a7c;++_0x5767ac){_0x23a897[_0x5767ac]['execute'](_0x1051c9);}},AutoExposure[a420_0xb8cffb(0x1a1)][a420_0xb8cffb(0x163)]=function(){return![];},AutoExposure[a420_0xb8cffb(0x1a1)][a420_0xb8cffb(0x1a4)]=function(){return destroyFramebuffers(this),destroyCommands(this),a420_0x4ded6f(this);};export default AutoExposure;